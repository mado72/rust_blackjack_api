{
  "info": {
    "name": "Blackjack API",
    "description": "Coleção completa de endpoints para testar a API Blackjack Multi-Player\n\n✅ STATUS M7 FASE 1: Enrollment endpoints DISPONÍVEIS (Jan 10, 2026)\n\n✅ Milestone 7 - FASE 1 (Enrollment) - COMPLETO:\n- POST /api/v1/games (Create Game com enrollment)\n- GET /api/v1/games/open (List Open Games)\n- POST /api/v1/games/:game_id/enroll (Enroll Player)\n- POST /api/v1/games/:game_id/close-enrollment (Close Enrollment)\n\n✅ Milestone 6 - COMPLETO:\n- Todos os 9 endpoints M6 estão FUNCIONAIS\n\nVer IMPLEMENTATION_STATUS.md para detalhes sobre próximas fases (M7 FASE 2-4).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "game_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "player_email",
      "value": "player1@example.com",
      "type": "string"
    },
    {
      "key": "card_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "invitation_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health Checks",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Verifica o status básico de saúde do servidor.\n\n**Não requer autenticação**"
          },
          "response": []
        },
        {
          "name": "Ready Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health/ready",
              "host": ["{{base_url}}"],
              "path": ["health", "ready"]
            },
            "description": "Verifica a prontidão detalhada de todos os componentes do sistema.\n\n**Não requer autenticação**"
          },
          "response": []
        }
      ],
      "description": "Endpoints públicos para verificação de saúde do servidor"
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salva o user_id e email para uso posterior",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('user_id', response.user_id);",
                  "    pm.collectionVariables.set('player_email', response.email);",
                  "    console.log('User ID salvo:', response.user_id);",
                  "    console.log('Email salvo:', response.email);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{player_email}}\",\n  \"password\": \"SecurePassword123!\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/register",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "register"]
            },
            "description": "Registra um novo usuário no sistema.\n\n**Body:**\n```json\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePassword123!\"\n}\n```\n\n**Response:**\n- UUID do usuário criado\n- Email confirmado\n- Mensagem de sucesso\n\n**Não requer autenticação**"
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Extrai e salva o token JWT automaticamente",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('jwt_token', response.token);",
                  "    console.log('Token JWT salvo:', response.token);",
                  "    console.log('Expira em:', response.expires_in, 'segundos');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{player_email}}\",\n  \"password\": \"SecurePassword123!\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "auth", "login"]
            },
            "description": "Autentica um usuário e retorna um token JWT.\n\n**Body:**\n```json\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePassword123!\"\n}\n```\n\n**Response:**\n- Token JWT com expiração de 24 horas\n- O token é automaticamente salvo na variável `jwt_token`\n\n**Não requer autenticação prévia**"
          },
          "response": []
        }
      ],
      "description": "Endpoints de autenticação e registro de usuários"
    },
    {
      "name": "Game Management",
      "item": [
        {
          "name": "Create Game (M7 - Enrollment Mode)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salva o game_id automaticamente",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('game_id', response.game_id);",
                  "    console.log('Game ID salvo:', response.game_id);",
                  "    console.log('Status:', response.game_phase);",
                  "    console.log('Enrollment expira em:', response.enrollment_timeout);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"enrollment_timeout_seconds\": 300\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/games",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games"]
            },
            "description": "**M7 FASE 1 - DISPONÍVEL ✅**\n\nCria um novo jogo no modo ENROLLMENT.\n\n**Body (opcional):**\n```json\n{\n  \"enrollment_timeout_seconds\": 300\n}\n```\n\n**Parâmetros:**\n- `enrollment_timeout_seconds`: Tempo em segundos para expiração do enrollment (opcional, padrão: 300s)\n\n**Response:**\n```json\n{\n  \"game_id\": \"uuid\",\n  \"creator_id\": \"uuid\",\n  \"game_phase\": \"Enrollment\",\n  \"enrollment_timeout\": \"2026-01-10T22:00:00Z\",\n  \"player_count\": 1\n}\n```\n\n**Requer autenticação JWT**\n**O criador é automaticamente o primeiro jogador**"
          },
          "response": []
        },
        {
          "name": "Get Open Games (M7)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/open",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "open"]
            },
            "description": "**M7 FASE 1 - DISPONÍVEL ✅**\n\nLista todos os jogos atualmente em fase de ENROLLMENT (abertos para novas inscrições).\n\n**Response:**\n```json\n{\n  \"games\": [\n    {\n      \"game_id\": \"uuid\",\n      \"creator_email\": \"creator@example.com\",\n      \"player_count\": 3,\n      \"enrollment_timeout\": \"2026-01-10T22:00:00Z\",\n      \"created_at\": \"2026-01-10T21:55:00Z\"\n    }\n  ]\n}\n```\n\n**Requer autenticação JWT**\n**Apenas jogos em fase de Enrollment são retornados**\n**Máximo 10 jogadores por jogo**"
          },
          "response": []
        },
        {
          "name": "Enroll Player (M7)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Verifica enrollment bem-sucedido",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('Enrollment confirmado para jogo:', response.game_id);",
                  "    console.log('Jogadores inscritos:', response.player_count);",
                  "    console.log('Mensagem:', response.message);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{player_email}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/enroll",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "enroll"]
            },
            "description": "**M7 FASE 1 - DISPONÍVEL ✅**\n\nInscreve um jogador em um jogo aberto (em fase de Enrollment).\n\n**Body:**\n```json\n{\n  \"email\": \"player@example.com\"\n}\n```\n\n**Validações:**\n- Jogo deve estar em fase Enrollment\n- Email no body deve corresponder ao email do JWT\n- Máximo 10 jogadores por jogo\n- Jogador não pode se inscrever duas vezes\n\n**Response:**\n```json\n{\n  \"game_id\": \"uuid\",\n  \"player_count\": 4,\n  \"message\": \"Player enrolled successfully\"\n}\n```\n\n**Erros possíveis:**\n- `409 Conflict`: Game is full (10 players)\n- `410 Gone`: Enrollment phase has ended\n- `403 Forbidden`: Email mismatch (JWT email ≠ body email)\n\n**Requer autenticação JWT**"
          },
          "response": []
        },
        {
          "name": "Close Enrollment (M7)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Verifica fechamento bem-sucedido",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('Enrollment fechado para jogo:', response.game_id);",
                  "    console.log('Total de jogadores:', response.player_count);",
                  "    console.log('Ordem de turnos gerada:', response.turn_order.length, 'jogadores');",
                  "    console.log('Mensagem:', response.message);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/close-enrollment",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "close-enrollment"]
            },
            "description": "**M7 FASE 1 - DISPONÍVEL ✅**\n\nFecha a fase de enrollment e inicia o jogo.\n\n**Validações:**\n- Jogo deve estar em fase Enrollment\n- Apenas o CRIADOR do jogo pode fechar enrollment\n- Automaticamente gera ordem de turnos aleatória\n\n**Response:**\n```json\n{\n  \"game_id\": \"uuid\",\n  \"player_count\": 5,\n  \"turn_order\": [\n    \"player3@example.com\",\n    \"player1@example.com\",\n    \"creator@example.com\",\n    \"player2@example.com\",\n    \"player4@example.com\"\n  ],\n  \"message\": \"Enrollment closed. Game is ready to start.\"\n}\n```\n\n**Erros possíveis:**\n- `403 Forbidden`: Only game creator can close enrollment\n- `410 Gone`: Enrollment phase already ended\n\n**Requer autenticação JWT**\n**CREATOR-ONLY endpoint**"
          },
          "response": []
        },
        {
          "name": "Get Game State",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}"]
            },
            "description": "Retorna o estado completo do jogo.\n\n**Response:**\n- Todos os jogadores e suas cartas\n- Pontos de cada jogador\n- Cartas restantes no baralho\n- Status de finalizado/ativo\n\n**Requer autenticação JWT**"
          },
          "response": []
        },
        {
          "name": "Finish Game",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/finish",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "finish"]
            },
            "description": "Finaliza o jogo e calcula o vencedor.\n\n**Response:**\n- Vencedor (email)\n- Jogadores empatados (se houver)\n- Pontuação mais alta\n- Informações de todos os jogadores\n\n**Requer autenticação JWT**"
          },
          "response": []
        },
        {
          "name": "Get Game Results",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/results",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "results"]
            },
            "description": "Retorna os resultados de um jogo finalizado.\n\n**Só funciona se o jogo já foi finalizado**\n\n**Response:**\n- Vencedor\n- Jogadores empatados\n- Pontuação final de todos\n\n**Requer autenticação JWT**"
          },
          "response": []
        }
      ],
      "description": "Endpoints para gerenciar jogos"
    },
    {
      "name": "Player Actions",
      "item": [
        {
          "name": "Draw Card",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salva o card_id da última carta comprada (útil para testar Set Ace Value)",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.card && response.card.name === 'Ace') {",
                  "        pm.collectionVariables.set('card_id', response.card.id);",
                  "        console.log('Ás comprado! Card ID salvo:', response.card.id);",
                  "    }",
                  "    console.log('Carta:', response.card.name, 'de', response.card.suit);",
                  "    console.log('Pontos atuais:', response.current_points);",
                  "    console.log('Estourou?', response.busted);",
                  "    console.log('Cartas restantes:', response.cards_remaining);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/draw",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "draw"]
            },
            "description": "Compra uma carta do baralho para o jogador autenticado.\n\n**Response:**\n- Carta comprada (nome, valor, naipe)\n- Pontos atuais\n- Se estourou (busted)\n- Cartas restantes no baralho\n- Histórico completo de cartas\n\n**Requer autenticação JWT**\n\n**Nota:** O script de teste salva automaticamente o ID de Ases para facilitar testes de mudança de valor."
          },
          "response": []
        },
        {
          "name": "Set Ace Value",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"card_id\": \"{{card_id}}\",\n  \"as_eleven\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/ace",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "ace"]
            },
            "description": "Altera o valor de um Ás entre 1 e 11 pontos.\n\n**Body:**\n```json\n{\n  \"card_id\": \"uuid-da-carta\",\n  \"as_eleven\": true\n}\n```\n\n**Parâmetros:**\n- `card_id`: UUID do Ás a ser alterado\n- `as_eleven`: `true` para 11 pontos, `false` para 1 ponto\n\n**Response:**\n- Pontos atualizados\n- Status de bust\n\n**Requer autenticação JWT**\n\n**Nota:** Use a variável `{{card_id}}` que é preenchida automaticamente quando você compra um Ás."
          },
          "response": []
        },
        {
          "name": "Stand",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/stand",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "stand"]
            },
            "description": "Jogador fica de pé (para de comprar cartas).\n\n**Response:**\n- Pontos atuais do jogador\n- Se o jogador estourou\n- Mensagem de sucesso\n- Se o jogo foi finalizado automaticamente (quando todos os jogadores terminaram)\n\n**Requer autenticação JWT**\n\n**Nota:** Se todos os jogadores ficarem de pé ou estourarem, o jogo é finalizado automaticamente."
          },
          "response": []
        }
      ],
      "description": "Ações que os jogadores podem realizar durante o jogo"
    },
    {
      "name": "Invitations",
      "item": [
        {
          "name": "Create Invitation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Salva o invitation_id automaticamente",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('invitation_id', response.invitation_id);",
                  "    console.log('Invitation ID salvo:', response.invitation_id);",
                  "    console.log('Convidado:', response.invitee_email);",
                  "    console.log('Expira em:', response.expires_at);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"invitee_email\": \"newplayer@example.com\",\n  \"timeout_seconds\": 600\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/games/{{game_id}}/invitations",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "games", "{{game_id}}", "invitations"]
            },
            "description": "Cria um convite para um jogador participar do jogo.\n\n**Body:**\n```json\n{\n  \"invitee_email\": \"newplayer@example.com\",\n  \"timeout_seconds\": 600\n}\n```\n\n**Parâmetros:**\n- `invitee_email`: Email do jogador a ser convidado\n- `timeout_seconds`: Tempo de expiração do convite em segundos (opcional)\n\n**Response:**\n- ID do convite\n- Email do convidado\n- Data/hora de expiração\n- Mensagem de sucesso\n\n**Requer autenticação JWT**\n**Apenas o criador do jogo pode enviar convites**"
          },
          "response": []
        },
        {
          "name": "Get Pending Invitations",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/invitations/pending",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "invitations", "pending"]
            },
            "description": "Lista todos os convites pendentes para o usuário autenticado.\n\n**Response:**\n- Lista de convites pendentes\n- Para cada convite: ID, jogo, convidante, data de criação e expiração\n\n**Requer autenticação JWT**"
          },
          "response": []
        },
        {
          "name": "Accept Invitation",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/invitations/{{invitation_id}}/accept",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "invitations", "{{invitation_id}}", "accept"]
            },
            "description": "Aceita um convite para participar de um jogo.\n\n**Response:**\n- Mensagem de sucesso\n\n**Requer autenticação JWT**\n**O usuário autenticado deve ser o destinatário do convite**"
          },
          "response": []
        },
        {
          "name": "Decline Invitation",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/invitations/{{invitation_id}}/decline",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "invitations", "{{invitation_id}}", "decline"]
            },
            "description": "Recusa um convite para participar de um jogo.\n\n**Response:**\n- Mensagem de sucesso\n\n**Requer autenticação JWT**\n**O usuário autenticado deve ser o destinatário do convite**"
          },
          "response": []
        }
      ],
      "description": "Endpoints para gerenciar convites de jogos"
    }
  ]
}
